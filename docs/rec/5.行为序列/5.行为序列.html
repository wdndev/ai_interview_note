<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../css/wolai.css"/><title>5.行为序列 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="5.行为序列" class="main-title"></div></div></header><article><h1 id="t4S2x8eb2M5P63LV4etmMX" class="wolai-block"><span class="inline-wrap">1.用户行为序列建模  </span></h1><ul class="wolai-block"><li id="aRCno27eebTPStUzyfvpaw"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">用户行为序列简称为 LastN，即用户最后交互的<span class="jill"></span>n<span class="jill"></span>个物品  
</span></li><li id="irAGuZrTm15ouPAUVYbqks"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">LastN 可以反映用户对什么样的物品感兴趣  </span></li></ul><h2 id="ctuzmTEC4QyksqSeRAAxjy" class="wolai-block"><span class="inline-wrap">1.1 </span><span class="inline-wrap"><b>LastN 特征</b></span></h2><ul class="wolai-block"><li id="3LAVufe3k3oS4Gxu9CKm2u"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">LastN：用户最近的<span class="jill"></span>n<span class="jill"></span>次交互（点击、点赞等）的物品 ID  
</span></li><li id="sdruh2W9UfVyiDdtvNEMu6"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">对 LastN 物品 ID 做 embedding，得到<span class="jill"></span>n<span class="jill"></span>个向量  
</span></li><li id="vLbf87LuW6m1yxLSqCAa3y"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">把<span class="jill"></span>n<span class="jill"></span>个向量取平均得到一个向量，作为用户的一种特征  
</span></li><li id="mz7XgX2qDk4mm3LgUZ2pXf"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">适用于召回双塔模型、粗排三塔模型、精排模型  </span></li></ul><div id="i8nSrq1vhjocUDb97eTkSJ" class="wolai-block"><figure class="wolai-center" style="width: 100%; flex-direction: column"><img src="media/image.png" style="width: 100%"/></figure></div><div id="vPhZwTvSP4gujcwP35exMc" class="wolai-block wolai-text"><div><span class="inline-wrap">参考文献：Covington, Adams, and Sargin. Deep neural networks for YouTube recommendations. In ACM Conference on Recommender Systems, 2016.  
</span></div></div><h2 id="gjFn2NY5ZZ55JDGZ8mKRiQ" class="wolai-block"><span class="inline-wrap">1.2<span class="jill"></span>小红书的实践  </span></h2><div id="7Jiieyqdc1WMFmxtpnekT3" class="wolai-block wolai-text"><div><span class="inline-wrap">小红书的召回、粗排、精排中都用到了 LastN 行为序列。  </span></div></div><ul class="wolai-block"><li id="fmv3YbWsUaVpMqM35JDqty"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">取平均是早期的用法，效果不错；现在更多的是用 </span><span class="red inline-wrap"><b>Attention  </b></span></li><li id="9dWMA1S1DAq8zCnb2q5Y5K"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">上面得到的多个</span><span class="red inline-wrap"><b>向量拼接起来</b></span><span class="inline-wrap">，作为一种用户特征，传到召回或排序模型中  </span></li><li id="6tnZdWRBtWMXwS1aK4ZcSP"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Embedding 不只有物品 ID，还会有物品类别等特征  </span></li></ul><div id="bw6wAnY254VggBPA9rASD9" class="wolai-block"><figure class="wolai-center" style="width: 100%; flex-direction: column"><img src="media/image_1.png" style="width: 100%"/></figure></div><h1 id="eDXvA6JxCQasyLYqjRXoM4" class="wolai-block"><span class="inline-wrap">2.DIN 模型</span></h1><div id="2ywvke6trASQMy3LrPgnqZ" class="wolai-block wolai-text"><div><span class="inline-wrap">对<span class="jill"></span>LastN<span class="jill"></span>建模的一种方法，效果优于平均</span></div></div><h2 id="tNDAnuYU58pB3ogKeqeSnD" class="wolai-block"><span class="inline-wrap">2.1 DIN 模型  </span></h2><ul class="wolai-block"><li id="ahGCtCRt3yRyd1czbZkh8j"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">DIN 用加权平均代替平均，即注意力机制（attention）  </span></li><li id="jMGEqecMpKaMGFYyYVYwR4"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">权重：</span><span class="red inline-wrap"><b>候选物品与用户 LastN 物品的相似度  </b></span></li></ul><div id="pJUTCJBhd2eG5gN6eb8Czh" class="wolai-block wolai-text"><div><span class="inline-wrap">参考文献：Zhou et al. Deep interest network for click-through rate prediction. In KDD, 2018.  </span></div></div><div id="kKfnUbmh2ejmrW3z9tuZBf" class="wolai-block wolai-text"><div><span class="inline-wrap">如下图所示：</span></div></div><ul class="wolai-block"><li id="mN635RHdkSdsTyFockNxvs"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">红色向量：用户交互过的<span class="jill"></span>LastN<span class="jill"></span>向量表征；</span></li><li id="p6aewMfgG567BVyTTJRp9R"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">蓝色向量：候选物品的向量表征；候选物品：比如粗排选出<span class="jill"></span>500<span class="jill"></span>个物品，这就是精排的候选物品；</span></li><li id="aHFo3Xz3uY9FRukcX9ToZu"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">计算相似度：计算</span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">x_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span class="inline-wrap">与<span class="jill"></span>q<span class="jill"></span>的相似度，....., 计算</span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span><span class="inline-wrap">与<span class="jill"></span>q<span class="jill"></span>的相似度；</span><span class="inline-wrap">计算相似度的方法很多，如 内积 和 余弦相似度 等  </span></li><li id="k5vzEYNcew3XnfTyRR54r6"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">紫色向量：与<span class="jill"></span>LastN<span class="jill"></span>向量相乘，得到加权和，权重是相似度</span></li></ul><div id="xwiyakJhwbkrFTF44csDkr" class="wolai-block"><figure class="wolai-center" style="width: 100%; flex-direction: column"><img src="media/image_2.png" style="width: 100%"/></figure></div><div id="3tdpTMqwKk4StqwxQ6Jw5R" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>DIN 模型总结  </b></span></div></div><ul class="wolai-block"><li id="4U2WkpNN9D5ow61JpdiraS"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">对于某候选物品，计算它与用户 LastN 物品的相似度  </span></li><li id="8PyfvSXx5Hsw2iLKW1oR3t"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">以相似度为权重，求用户 LastN 物品向量的加权和，结果是一个向量  </span></li><li id="3Vzuic2DEG2w8NkzFHSckh"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">把得到的向量作为一种用户特征，输入排序模型，预估（用户，候选物品）的点击率、点赞率等指标  </span></li><li id="t1T5NtCfA6V4p2LTnVuRUR"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="red inline-wrap"><b>本质是注意力机制（attention） </b></span><span class="inline-wrap"> </span></li></ul><div id="je6Nj66NJ2YD4HJDuHMiLy" class="wolai-block"><figure class="wolai-center" style="width: 100%; flex-direction: column"><img src="media/image_3.png" style="width: 100%"/></figure></div><div id="kj6QCMK86BUmdLrbnARiTP" class="wolai-block wolai-text"><div><span class="inline-wrap">DIN 的本质是注意力机制</span></div></div><h2 id="5cTthh5k6Q9dAf7Bo3USFx" class="wolai-block"><span class="inline-wrap">2.2<span class="jill"></span>简单平均 vs. 注意力机制  </span></h2><div id="hFZgugQDh4e4vFCT5G7fbc" class="wolai-block wolai-text"><div><span class="inline-wrap">简单平均 和 注意力机制 都适用于精排模型  </span></div></div><div id="TdTquUKUU8v7KwZoPZ8T9" class="wolai-block wolai-text"><div><span class="red inline-wrap"><b>简单平均适用于双塔模型、三塔模型 </b></span><span class="inline-wrap"> </span></div></div><ul class="wolai-block"><li id="fsfUQgTjywF9EzjqjT23WH"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">简单平均只需要用到 LastN，属于用户自身的特征，与候选物品无关  </span></li><li id="qeVFBx4qbtge5fenWcuA5N"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">把 LastN 向量的平均作为用户塔的输入  </span></li></ul><div id="nw8PnHANNoQ4117M7pnjGa" class="wolai-block wolai-text"><div><span class="red inline-wrap"><b>注意力机制不适用于双塔模型、三塔模型  </b></span></div></div><ul class="wolai-block"><li id="w46gAFrSche4NZSSQ8aHby"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">注意力机制 需要用到 LastN + 候选物品  </span></li><li id="scPNV358zU1SRfr7jcQPmy"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">用户塔看不到候选物品，不能把 注意力机制 用在用户塔  ，但是<span class="jill"></span>DIN<span class="jill"></span>需要候选特征，所以<span class="jill"></span>DIN<span class="jill"></span>不能放在用户塔。</span></li></ul><div id="pqneinrfGWcYxTphEa1CGZ" class="wolai-block"><figure class="wolai-center" style="width: 574px; flex-direction: column"><img src="media/image_4.png" style="width: 100%"/></figure></div><div id="k36iCpA7bebiLqBcoSVzY5" class="wolai-block"><figure class="wolai-center" style="width: 629px; flex-direction: column"><img src="media/image_5.png" style="width: 100%"/></figure></div><h1 id="3FTx7y3oEfBRHEVXJS87G9" class="wolai-block"><span class="inline-wrap">3.SIM 模型  </span></h1><div id="vJ9duAcUnjUEEWCB44WVz2" class="wolai-block wolai-text"><div><span class="inline-wrap">SIM 模型的主要目的是保留用户的长期兴趣。  </span></div></div><h2 id="r9iTrb2zCcrkzjN9v64D6C" class="wolai-block"><span class="inline-wrap">3.1<span class="jill"></span>回顾 DIN 模型</span></h2><div id="b6qA8bnQV9XjzMbFATwq8H" class="wolai-block wolai-text"><div><span class="inline-wrap">DIN 模型</span></div></div><ul class="wolai-block"><li id="rZHBv9EfM8QuRGkgCSGqnM"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">计算用户 LastN 向量的加权平均  </span></li><li id="gL7GnekVFuyFoqnFEhw7QZ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">权重是候选物品与 LastN 物品的相似度  </span></li></ul><div id="77cjKK5asgVJfch7kh9adB" class="wolai-block wolai-text"><div><span class="inline-wrap">DIN 模型的缺点：</span></div></div><ul class="wolai-block"><li id="6oAsTP94FPeDtv9wgYu72S"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">注意力层的计算量 </span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∝</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">∝n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mrel">∝</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></span><span class="inline-wrap">（用户行为序列的长度），只能记录最近几百个物品，否则计算量太大</span></li><li id="sRBskVCXMoy1QKbQn2YknE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="red inline-wrap"><b>关注短期兴趣，遗忘长期兴趣；</b></span><span class="inline-wrap">通过实验发现，增长记录的行为序列，可以显著提升推荐系统的所有指标，但增加的计算量太大了  </span></li></ul><div id="nhkEvw3sbgY7HhGXE6qNfR" class="wolai-block wolai-text"><div><span class="inline-wrap">参考文献：Zhou et al. Deep interest network for click-through rate prediction. In KDD, 2018. </span></div></div><div id="fe9e7o8RPSTDD2dHeHB3GW" class="wolai-block"><figure class="wolai-center" style="width: 100%; flex-direction: column"><img src="media/image_6.png" style="width: 100%"/></figure></div><div id="sZqW59efxDbCfo4A4LELNh" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>如何改进 DIN？</b></span></div></div><ul class="wolai-block"><li id="sysUQKhRNdkKsPoJECmMw3"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="red inline-wrap"><b>目标</b></span><span class="inline-wrap">：保留用户长期行为序列（n<span class="jill"></span>很大），而且计算量不会过大</span></li><li id="v58yw74ZbyvSbgaQEWijc6"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">改进 DIN：DIN 对 LastN 向量做加权平均，权重是相似度 ；</span><span class="red inline-wrap"><b>如果某 LastN 物品与候选物品差异很大，则权重接近零；快速排除掉与候选物品无关的 LastN 物品，降低注意力层的计算量。  </b></span></li></ul><h2 id="9keaQqr6FFDyUM1AvMg2Gk" class="wolai-block"><span class="inline-wrap">3.2 SIM 模型  </span></h2><ul class="wolai-block"><li id="hf9uDMByivVggS4o1mZSRo"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">保留用户长期行为记录，n<span class="jill"></span>的大小可以是几千；如果不用<span class="jill"></span>SIM，n<span class="jill"></span>的大小一般是<span class="jill"></span>200<span class="jill"></span>左右
</span></li><li id="qw3txrthWMpezctmfgSemt"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="red inline-wrap"><b>对于每个候选物品，在用户 LastN 记录中做快速查找，找到<span class="jill"></span>k<span class="jill"></span>个相似物品 </b></span><span class="inline-wrap"> </span></li><li id="fDf1y59hYy7PZFQTh3aHYu"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">把 LastN 变成 TopK，然后输入到注意力层  
</span></li><li id="pQAmSbUaWsnzzX5swtAZSJ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">SIM 模型减小计算量（从<span class="jill"></span>n<span class="jill"></span>降到<span class="jill"></span>k）  
</span></li><li id="ng93YaN8txQakNg8wXMbu1"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">参考文献：Qi et al. Search-based User Interest Modeling with Lifelong Sequential Behavior Data for Click-Through Rate Prediction. In CIKM, 2020.  </span></li></ul><h3 id="SnbRrVsY4GvMB9z81X5C8" class="wolai-block"><span class="inline-wrap">（1）查找
</span></h3><ul class="wolai-block"><li id="6MXgekG6rdKUA2WKqBb17h"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">方法一：</span><span class="red inline-wrap"><b>Hard Search</b></span><span class="inline-wrap">：根据规则做筛选○根据候选物品的类目，保留 LastN 物品中类目相同的；简单，快速，无需训练  。</span></li><li id="ic6A1uhw7xP9SYKnGu7w85"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">方法二：</span><span class="red inline-wrap"><b>Soft Search</b></span><span class="inline-wrap">：把物品做 embedding，变成向量 ；把候选物品向量作为 query，做<span class="jill"></span>k<span class="jill"></span>近邻查找，保留 LastN 物品中最接近的<span class="jill"></span>k<span class="jill"></span>个；</span><span class="yellow inline-wrap"><b>效果更好，编程实现更复杂  </b></span></li></ul><h3 id="tpnymCRxPrD81xcGRGpKua" class="wolai-block"><span class="inline-wrap">（2）注意力机制  </span></h3><div id="mtvdXVaBFYSq9yb5rWGrN7" class="wolai-block wolai-text"><div><span class="inline-wrap">本质上核<span class="jill"></span>DIN<span class="jill"></span>没有区别，</span><span class="red inline-wrap"><b>只不过用用户的<span class="jill"></span>TopK<span class="jill"></span>交互记录，而不是<span class="jill"></span>LastN<span class="jill"></span>交互记录</b></span><span class="inline-wrap">。</span></div></div><div id="wFyyNCJYCKWztGupEJMkkZ" class="wolai-block"><figure class="wolai-center" style="width: 100%; flex-direction: column"><img src="media/image_7.png" style="width: 100%"/></figure></div><h2 id="E593aypS9N4NApdbfUHV1" class="wolai-block"><span class="inline-wrap">3.3 Trick：使用时间信息  </span></h2><div id="x6y3sGWHj8AQJKjweCJT91" class="wolai-block wolai-text"><div><span class="inline-wrap">用户与某个 LastN 物品的交互时刻距今为</span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>δ</mi></mrow><annotation encoding="application/x-tex">\delta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span></span></span></span></span></div></div><div id="tks8RPhHg4vJRJ33iCXApB" class="wolai-block wolai-text"><div><span class="inline-wrap"> 对</span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>δ</mi></mrow><annotation encoding="application/x-tex">\delta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span></span></span></span></span><span class="inline-wrap">做离散化，再做 embedding，变成向量<span class="jill"></span>d；例如把时间离散为 1 天内、7 天内、30 天内、一年、一年以上  
</span></div></div><div id="hJrXdwdA4NLss5MLwCsUDp" class="wolai-block wolai-text"><div><span class="inline-wrap">把两个向量做 concatenation，表征一个 LastN 物品交互记录</span></div></div><ul class="wolai-block"><li id="msc2MozBLwopzG9NAqqow6"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">向量</span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span></span><span class="inline-wrap">是物品 embedding  </span></li><li id="wmtGgbyPxfY7GLruiimcri"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">向量</span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span></span><span class="inline-wrap">是时间的 embedding </span></li></ul><div id="jp9H3aAznMKLVsRKkHtjZZ" class="wolai-block"><figure class="wolai-center" style="width: 100%; flex-direction: column"><img src="media/image_8.png" style="width: 100%"/></figure></div><div id="n2PixaMNVvMHZiMqKenPHa" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>为什么 SIM 使用时间信息？  </b></span></div></div><ul class="wolai-block"><li id="r54DXdUoURYjfwBDxeEhwx"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">DIN 的序列短，记录用户近期行为  </span></li><li id="sSmUYHMwg3DVvek7pPdt8R"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">SIM 的序列长，记录用户长期行为  </span></li><li id="esPpFwGWfxjD3dExQisSiJ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">时间越久远，重要性越低  </span></li></ul><h2 id="vbe5eRcMuhjg9yB4Ag8To2" class="wolai-block"><span class="inline-wrap">3.4<span class="jill"></span>结论  </span></h2><div id="tZY6UBoAzti1nqcqEk888S" class="wolai-block wolai-text"><div><span class="inline-wrap">长序列（长期兴趣）优于短序列（近期兴趣）  </span></div></div><div id="d2DqN3g8HGQoGZLPXkyQL5" class="wolai-block wolai-text"><div><span class="inline-wrap">注意力机制优于简单平均  </span></div></div><div id="298c9bupqwK3fnpC7uxKv" class="wolai-block wolai-text"><div><span class="inline-wrap">Soft search 还是 hard search？取决于工程基建  </span></div></div><div id="whRVWxeH472YvMTJsAKkhs" class="wolai-block wolai-text"><div><span class="inline-wrap">使用时间信息有提升  </span></div></div><div id="xiL9NwjhVMr5EVBrjkQScj" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div id="3SK4XEAkFu99JyZDwkQyYn" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></article><footer></footer></body></html>